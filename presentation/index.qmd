---
title: "CI/CD Workshop for R Packages"
subtitle: "R in Pharma, November 4th, 2022"
execute:
  echo: false
  warning: false
  error: false
  eval: true
  output: asis
  comment: ''
format:
  revealjs: 
    slide-number: true
    chalkboard: 
      buttons: false
    preview-links: auto
    logo: https://avatars.githubusercontent.com/u/84541169
    footer: <[CI-CD GitHub](https://github.com/pharmaverse/cicdworkshop.rinpharma2022)>
    theme: [simple, custom.scss]
    from: markdown+emoji
---

```{r}
render_file <- function(filepath, language = "yaml") {
  cat(paste0("```", language, "\n"))
  cat(readLines(filepath), sep = '\n')
  cat("```\n")
}
```

## Hello CI/CD

<br>

This workshop will both discuss and show you how to implement 8 **simple** CI/CD workflows for a **bare bones** R package

::: {.incremental}
* Emphasis on the **simple** and the **bare bones**
* A bare bones R packages means we can focus on the workflows
::: 

## What to expect for next 3 hours?

<br>

* Setting up GitHub and RStudio (20 mins)
* Discussion on Flow of the Workshop (5 mins)
* Discussion on why CI/CD can be helpful for developing software projects (10 mins)
* Work through the 8 workflows (remainder of the workshop)
* Break for 10 mins after the 2 worfklows

## Preparation for the Workshop

::: {.absolute top="0" left="100%"}
::: {.sectionhead}
[Setup]{style="opacity:0.25"}
:::
:::

::: {.incremental}
- Set up GitHub to Run our CI/CD checks through GitHub Actions
- Set up RStudio Cloud Classroom for both ease of access and setup
- Quick overview of **bare bones** R package as our learning tool
- We will do each step with you 

:::

## GitHub

::: {.absolute top="0" left="100%"}
::: {.sectionhead}
[Setup]{style="opacity:0.25"}
:::
:::

::: {.incremental}
- Use GitHub Template from [CI/CD Workshop at R/Pharma conference 2022](https://github.com/pharmaverse/cicdworkshop.rinpharma2022)
  - Templates are great ways to help "set things" up without all the baggage of     forking a repo.
  - Copy the template to your personal area on GitHub
  - Mark as public.  Private repos will cost you money.
- Create a new branch called `devel`
- Set up a [Personal Access Token ](https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token)
:::

## RStudio Cloud

::: {.absolute top="0" left="100%"}
::: {.sectionhead}
[Setup]{style="opacity:0.25"}
:::
:::

::: {.incremental}
- We recommend using RStudio Cloud for ease of use.  However, okay to use other RStudio infrastructure, but harder for us to diagnose or help.
- Sharing the RStudio Classroom link in Chat
- Using `https` link, clone into your RStudio Session
- Install the `{devtools}` package.
- Use `devtools::install_dev_deps()` to quickly get all necessary packages
::: 

## Link GitHub and RStudio 

::: {.absolute top="0" left="100%"}
::: {.sectionhead}
[Setup]{style="opacity:0.25"}
:::
:::
- Using Git Tab switch to `devel` branch
- Let's do a test commit 
  - Modify the `README.md` file
  - Click Commit button > click check box > add a message
  - Push up the Commit to GitHub 
  - Verify Push was completed (might need a refresh)
- Good practice to Pull Down 


## Flow for Workshop

```{mermaid}
flowchart TD
  A(Discuss the need <br> for the Workflow) --> B(Copy Code and place <br> into .github/workflows folder)
  B --> C(Push up into devel branch)
  C --> D(Watch GitHub give you <br> feedback on the workflow)
  D --> E(Address Feedback and <br> fix in the devel branch)
  E --> F(Discuss successful implementation)
  F --> A[Discuss the need <br> for the Workflow]
```

::: footer
::: 

## Jargon Review

??

## Why use CI/CD for a R package?

::: {.incremental}
- Multiple Contributors on your R Package :keyboard:
- User base on multiple types of OS and multiple versions of R `r fontawesome::fa("handshake", "blue")` 
- Faster turnaround on Pull Requests :heavy_check_mark:
- Flag coding issues for the contributor `r fontawesome::fa("flag", "yellow")` 
- Enforce coding style conventions `r fontawesome::fa("pencil-square", "red")`
:::

## The R Package for the Workshop

```{r}
render_file(file.path('..', 'R', 'hello.R'), "r")
```

<!--
## The R Package for the Workshop

Package is super lean to help focus on the CI/CD part.

```{r}
cat(paste0("```bash\n"))
library(fs)
tree <- dir_tree("..", recurse = 1)
cat("```")
```
-->

## The 8 Workflows we are going to implement

::: {.absolute top="0" left="100%"}
::: {.sectionhead}
1 [2 3 4 5 6 7 8]{style="opacity:0.25"}
:::
:::
<!-- https://fontawesome.com/icons/file-lines?s=solid&f=classic  -->
 
::: {.incremental}
1. R-CMD Check &nbsp; &nbsp; `r fontawesome::fa("code", "yellow")` 
1. Links & URLs &nbsp; &nbsp;`r fontawesome::fa("link", "yellow")`
1. Spelling Checks &nbsp; &nbsp;`r fontawesome::fa("pen", "yellow")`
1. Linters  &nbsp; &nbsp;`r fontawesome::fa("file-lines", "yellow")` 
1. Manual Pages &nbsp; &nbsp;`r fontawesome::fa("book", "yellow")` 
1. Publishing a pkgdown site &nbsp; &nbsp;`r fontawesome::fa("wifi", "yellow")`
1. Style &nbsp; &nbsp;`r fontawesome::fa("scroll", "yellow")`
1. Test Coverage &nbsp; &nbsp;`r fontawesome::fa("car-burst", "yellow")`

:::

## R-CMD Checks `r fontawesome::fa("code", "yellow")`

::: {.absolute top="0" left="100%"}
::: {.sectionhead}
1 [2 3 4 5 6 7 8]{style="opacity:0.25"}
:::
:::

<br>
Why have a workflow that checks the Package Build?
<br>


::: {.incremental}
- Check to make sure it runs on multiple versions of R
- Check to make sure it runs on multiple snapshots of R packages
- Check to make sure it runs on different OS
- Check integrity of code from contributors before you review the Pull Request
:::


## R-CMD Workflow

::: {.absolute top="0" left="100%"}
::: {.sectionhead}
1 [2 3 4 5 6 7 8]{style="opacity:0.25"}
:::
:::

```{r}
render_file(file.path('..', '.github', 'workflows', 'r-cmd-check.yml'))
```

::: footer
Advanced Usage: [AdmiralCI's R CMD Check Workflow](https://raw.githubusercontent.com/pharmaverse/admiralci/main/.github/workflows/r-cmd-check.yml)
:::

## R-CMD Checks

::: {.absolute top="0" left="100%"}
::: {.sectionhead}
1 [2 3 4 5 6 7 8]{style="opacity:0.25"}
:::
:::

- Success!

![](images/success_rcmd.png)

## Links & URLs

::: {.absolute top="0" left="100%"}
::: {.sectionhead}
[1]{style="opacity:0.25"} 2 [3 4 5 6 7 8]{style="opacity:0.25"}
:::
:::

<br>
Why have a workflow that checks Links in your Package?
<br>


::: {.incremental}
- Check to make sure it runs on multiple versions of R
- Check to make sure it runs on multiple snapshots of R packages
- Check to make sure it runs on different OS
- Check integrity of code from contributor
:::

## Links Workflow

::: {.absolute top="0" left="100%"}
::: {.sectionhead}
[1]{style="opacity:0.25"} 2 [3 4 5 6 7 8]{style="opacity:0.25"}
:::
:::

```{r}
render_file(file.path('..', '.github', 'workflows', 'links.yml'))
```

::: footer
Advanced Usage: [AdmiralCI's Link Check Workflow](https://raw.githubusercontent.com/pharmaverse/admiralci/main/.github/workflows/links.yml)
:::

## Spelling Checks

::: {.absolute top="0" left="100%"}
::: {.sectionhead}
[1 2]{style="opacity:0.25"} 3 [4 5 6 7 8]{style="opacity:0.25"}
:::
:::

```{r}
render_file(file.path('..', '.github', 'workflows', 'spellcheck.yml'))
```

::: footer
Advanced Usage: [AdmiralCI's Spellcheck Workflow](https://raw.githubusercontent.com/pharmaverse/admiralci/main/.github/workflows/spellcheck.yml)
:::

## Linters

::: {.absolute top="0" left="100%"}
::: {.sectionhead}
[1 2 3]{style="opacity:0.25"} 4 [5 6 7 8]{style="opacity:0.25"}
:::
:::

```{r}
render_file(file.path('..', '.github', 'workflows', 'linter.yml'))
```

::: footer
Advanced Usage: [AdmiralCI's `lintr` Workflow](https://raw.githubusercontent.com/pharmaverse/admiralci/main/.github/workflows/lintr.yml)
:::


## Manual Pages

::: {.absolute top="0" left="100%"}
::: {.sectionhead}
[1 2 3 4]{style="opacity:0.25"} 5 [6 7 8]{style="opacity:0.25"}
:::
:::

```{r}
render_file(file.path('..', '.github', 'workflows', 'roxygen.yml'))
```

::: footer
Advanced Usage: [AdmiralCI's `roxygen` Workflow](https://raw.githubusercontent.com/pharmaverse/admiralci/main/.github/workflows/man-pages.yml)
:::

## Publishing a pkgdown site

::: {.absolute top="0" left="100%"}
::: {.sectionhead}
[1 2 3 4 5]{style="opacity:0.25"} 6 [7 8]{style="opacity:0.25"}
:::
:::

```{r}
render_file(file.path('..', '.github', 'workflows', 'pkgdown.yml'))
```

::: footer
Advanced Usage: [AdmiralCI's `pkgdown` Workflow](https://raw.githubusercontent.com/pharmaverse/admiralci/main/.github/workflows/pkgdown.yml)
:::

## Style

::: {.absolute top="0" left="100%"}
::: {.sectionhead}
[1 2 3 4 5 6 7]{style="opacity:0.25"} 8 []{style="opacity:0.25"}
:::
:::

```{r}
render_file(file.path('..', '.github', 'workflows', 'style.yml'))
```

::: footer
Advanced Usage: [AdmiralCI's `styler` Workflow](https://raw.githubusercontent.com/pharmaverse/admiralci/main/.github/workflows/style.yml)
:::

## Test Coverage

::: {.absolute top="0" left="100%"}
::: {.sectionhead}
[1 2 3 4 5 6]{style="opacity:0.25"} 7 [8]{style="opacity:0.25"}
:::
:::

```{r}
render_file(file.path('..', '.github', 'workflows', 'coverage.yml'))
```

::: footer
Advanced Usage: [AdmiralCI's `covr` Workflow](https://raw.githubusercontent.com/pharmaverse/admiralci/main/.github/workflows/coverage.yml)
:::
